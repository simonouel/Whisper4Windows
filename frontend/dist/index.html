<!DOCTYPE html>
<html lang="en" data-theme="system">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whisper4Windows</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root[data-theme="light"] {
            --bg-main: #f5f5f5;
            --bg-sidebar: #f0f0f0;
            --bg-card: #ffffff;
            --border-color: #e0e0e0;
            --text-primary: #2a2a2a;
            --text-secondary: #666;
            --text-sidebar: #666;
            --sidebar-active: #e0e0e0;
            --sidebar-hover: #e8e8e8;
            --scrollbar-thumb: #c0c0c0;
            --scrollbar-track: #f5f5f5;
        }

        :root[data-theme="dark"] {
            --bg-main: #1a1a1a;
            --bg-sidebar: #2a2a2a;
            --bg-card: #2d2d2d;
            --border-color: #3a3a3a;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --text-sidebar: #a0a0a0;
            --sidebar-active: #404040;
            --sidebar-hover: #363636;
            --scrollbar-thumb: #4a4a4a;
            --scrollbar-track: #1a1a1a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-sidebar);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #808080;
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 20px 0;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            margin: 4px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            color: var(--text-sidebar);
            font-size: 14px;
            font-weight: 500;
        }

        .sidebar-item:hover {
            background: var(--sidebar-hover);
        }

        .sidebar-item.active {
            background: var(--sidebar-active);
            color: var(--text-primary);
        }

        .sidebar-item-icon {
            font-size: 18px;
            margin-right: 12px;
            width: 24px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            background: var(--bg-main);
            overflow-y: auto;
            padding: 40px 60px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 30px;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 50px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            display: flex;
            align-items: start;
            justify-content: space-between;
            transition: all 0.2s;
            cursor: pointer;
        }

        .card:hover {
            border-color: #c0c0c0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .card-icon {
            font-size: 24px;
            margin-right: 20px;
            opacity: 0.6;
        }

        .card-content {
            flex: 1;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .card-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .card-badge {
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            border: 1px solid var(--border-color);
            font-family: 'Courier New', monospace;
        }

        /* What's New Section */
        .whats-new-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .whats-new-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .view-all-link {
            color: #667eea;
            font-size: 14px;
            text-decoration: none;
            font-weight: 500;
        }

        .changelog-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .changelog-date {
            color: #999;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .changelog-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .changelog-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Configuration Page Styles */
        .config-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 28px;
            margin-bottom: 24px;
        }

        .config-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 24px;
        }

        .config-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .config-row:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .config-row:first-child {
            padding-top: 0;
        }

        .config-row-left {
            flex: 1;
        }

        .config-row-title {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .config-row-description {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .config-row-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Shortcut Badge */
        .shortcut-badge {
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            border: 1px solid var(--border-color);
            min-width: 80px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .shortcut-badge:hover {
            border-color: #667eea;
        }

        .shortcut-badge.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .shortcut-badge.recording {
            background: #667eea;
            border-color: #667eea;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Select Dropdown */
        select {
            padding: 8px 32px 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: var(--bg-card);
            color: var(--text-primary);
            cursor: pointer;
            min-width: 200px;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Custom Dropdown */
        .custom-dropdown {
            position: relative;
            min-width: 250px;
        }

        .dropdown-header {
            padding: 10px 36px 10px 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-card);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: border-color 0.2s;
            position: relative;
        }

        .dropdown-header:hover {
            border-color: #667eea;
        }

        .dropdown-header::after {
            content: '‚ñº';
            position: absolute;
            right: 12px;
            font-size: 10px;
            opacity: 0.6;
            transition: transform 0.2s;
        }

        .dropdown-header.open::after {
            transform: rotate(180deg);
        }

        .dropdown-content {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-search {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 1;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-main);
            color: var(--text-primary);
            font-size: 13px;
        }

        .dropdown-search input:focus {
            outline: none;
            border-color: #667eea;
        }

        .dropdown-option {
            padding: 10px 14px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            transition: background 0.15s;
        }

        .dropdown-option:hover {
            background: var(--sidebar-hover);
        }

        .dropdown-option.selected {
            background: #667eea;
            color: white;
        }

        .dropdown-option.pinned {
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }

        /* Button Styles */
        .btn {
            padding: 8px 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-card);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn:hover {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 28px;
            background: #ccc;
            border-radius: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: left 0.3s;
        }

        .toggle-switch.active::after {
            left: 25px;
        }

        /* Reset Icon */
        .reset-icon {
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
            font-size: 16px;
        }

        .reset-icon:hover {
            opacity: 1;
        }

        /* Status Indicator */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: #e8f5e9;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            font-size: 13px;
            color: #155724;
            font-weight: 500;
        }

        .status-indicator.offline {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        /* Coming Soon Badge */
        .coming-soon {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
        }

        .coming-soon h3 {
            font-size: 18px;
            color: #856404;
            margin-bottom: 8px;
        }

        .coming-soon p {
            color: #856404;
            font-size: 14px;
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Device Buttons */
        .device-buttons {
            display: flex;
            gap: 8px;
        }

        .device-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-card);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .device-btn:hover {
            border-color: #667eea;
        }

        .device-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Volume Slider */
        .volume-slider {
            width: 100%;
            max-width: 300px;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            outline: none;
            appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        /* Shortcut Capture Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
        }

        .modal h3 {
            font-size: 18px;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .modal p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-item active" onclick="navigateToPage('home')">
            <span class="sidebar-item-icon">üè†</span>
            Home
        </div>
        <div class="sidebar-item" onclick="navigateToPage('vocabulary')">
            <span class="sidebar-item-icon">üìñ</span>
            Vocabulary
        </div>
        <div class="sidebar-item" onclick="navigateToPage('configuration')">
            <span class="sidebar-item-icon">‚öôÔ∏è</span>
            Configuration
        </div>
        <div class="sidebar-item" onclick="navigateToPage('sound')">
            <span class="sidebar-item-icon">üîä</span>
            Sound
        </div>
        <div class="sidebar-item" onclick="navigateToPage('history')">
            <span class="sidebar-item-icon">üïê</span>
            History
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- HOME PAGE -->
        <div id="page-home" class="page">
            <h1 class="section-title">Get started</h1>

            <div class="cards-grid">
                <div class="card" onclick="navigateToPage('configuration')">
                    <span class="card-icon">‚è∫</span>
                    <div class="card-content">
                        <div class="card-title">Start recording</div>
                        <div class="card-description">Turn your voice to text with a single click.</div>
                    </div>
                    <div class="card-badge">F9</div>
                </div>

                <div class="card" onclick="navigateToPage('configuration', 'shortcuts')">
                    <span class="card-icon">‚úã</span>
                    <div class="card-content">
                        <div class="card-title">Customize your shortcuts</div>
                        <div class="card-description">Change the keyboard shortcuts for Whisper4Windows.</div>
                    </div>
                </div>

                <div class="card" onclick="navigateToPage('vocabulary')">
                    <span class="card-icon">üìñ</span>
                    <div class="card-content">
                        <div class="card-title">Add vocabulary</div>
                        <div class="card-description">Teach Whisper4Windows custom words, names, or industry terms.</div>
                    </div>
                </div>
            </div>

            <div class="whats-new-header">
                <h2>What's new?</h2>
                <a href="#" class="view-all-link">View all changes</a>
            </div>

            <div class="changelog-item">
                <div class="changelog-date">Oct 2, 2025</div>
                <div class="changelog-title">F9 Global Hotkey & Live Audio Visualization</div>
                <div class="changelog-description">
                    Press F9 from anywhere to start/stop recording. New 80-bar live audio visualizer shows real-time feedback during recording, with smooth wave animation during processing.
                </div>
            </div>

            <div class="changelog-item">
                <div class="changelog-date">Oct 1, 2025</div>
                <div class="changelog-title">GPU Acceleration & Fast Text Injection</div>
                <div class="changelog-description">
                    10x faster transcription with NVIDIA GPU support. Text now injects instantly via clipboard paste instead of character-by-character. Global Esc key cancels recording anytime.
                </div>
            </div>
        </div>

        <!-- VOCABULARY PAGE -->
        <div id="page-vocabulary" class="page hidden">
            <h1 class="section-title">Vocabulary</h1>
            <div class="coming-soon">
                <h3>üöß Coming Soon</h3>
                <p>Custom vocabulary feature is under development. You'll soon be able to teach Whisper4Windows custom words, names, and industry-specific terms.</p>
            </div>
        </div>

        <!-- CONFIGURATION PAGE -->
        <div id="page-configuration" class="page hidden">
            <h1 class="section-title">Configuration</h1>

            <!-- Keyboard Shortcuts Section -->
            <div class="config-section" id="section-shortcuts">
                <h3 class="config-section-title">Keyboard Shortcuts</h3>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Toggle Recording</div>
                        <div class="config-row-description">Starts and stops recordings</div>
                    </div>
                    <div class="config-row-right">
                        <span class="reset-icon" onclick="resetShortcut('toggle')">‚Üª</span>
                        <div class="shortcut-badge" id="shortcut-toggle" onclick="captureShortcut('toggle')">F9</div>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Cancel Recording</div>
                        <div class="config-row-description">Discards the active recording</div>
                    </div>
                    <div class="config-row-right">
                        <span class="reset-icon" onclick="resetShortcut('cancel')">‚Üª</span>
                        <div class="shortcut-badge" id="shortcut-cancel" onclick="captureShortcut('cancel')">Esc</div>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Switch Mode</div>
                        <div class="config-row-description">Activates the mode switcher</div>
                    </div>
                    <div class="config-row-right">
                        <span class="reset-icon" style="opacity: 0.3;">‚Üª</span>
                        <div class="shortcut-badge disabled">‚Äî</div>
                    </div>
                </div>
            </div>

            <!-- Speech-to-Text Section -->
            <div class="config-section">
                <h3 class="config-section-title">Speech-to-Text</h3>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Backend Status</div>
                        <div class="config-row-description">Connection to transcription engine</div>
                    </div>
                    <div class="config-row-right">
                        <div class="status-indicator" id="backendStatus">
                            <span>‚è≥</span>
                            <span>Checking...</span>
                        </div>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Model Quality</div>
                        <div class="config-row-description">Transcription accuracy vs speed</div>
                    </div>
                    <div class="config-row-right">
                        <div class="custom-dropdown" id="modelDropdown">
                            <div class="dropdown-header" onclick="toggleModelDropdown()">
                                <span id="selectedModel">Small (Recommended)</span>
                            </div>
                            <div class="dropdown-content" id="modelDropdownContent">
                                <div id="modelOptions"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Processing Device</div>
                        <div class="config-row-description">CPU or GPU acceleration</div>
                    </div>
                    <div class="config-row-right">
                        <div class="device-buttons">
                            <button class="device-btn active" id="deviceAuto" onclick="selectDevice('auto')">Auto</button>
                            <button class="device-btn" id="deviceGPU" onclick="selectDevice('cuda')">GPU</button>
                            <button class="device-btn" id="deviceCPU" onclick="selectDevice('cpu')">CPU</button>
                        </div>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">GPU Acceleration Libraries</div>
                        <div class="config-row-description">Download CUDA libraries for GPU support</div>
                    </div>
                    <div class="config-row-right">
                        <button class="btn" onclick="manualGPUSetup()">Install GPU Libraries...</button>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Save to Clipboard</div>
                        <div class="config-row-description">Keep transcribed text in clipboard</div>
                    </div>
                    <div class="config-row-right">
                        <div class="toggle-switch active" id="clipboardToggle" onclick="toggleClipboardPaste()"></div>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Language</div>
                        <div class="config-row-description">Select transcription language</div>
                    </div>
                    <div class="config-row-right">
                        <div class="custom-dropdown" id="languageDropdown">
                            <div class="dropdown-header" onclick="toggleLanguageDropdown()">
                                <span id="selectedLanguage">English</span>
                            </div>
                            <div class="dropdown-content" id="languageDropdownContent">
                                <div class="dropdown-search">
                                    <input type="text" placeholder="Search languages..." id="languageSearch" oninput="filterLanguages()">
                                </div>
                                <div id="languageOptions"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Appearance Section -->
            <div class="config-section">
                <h3 class="config-section-title">Appearance</h3>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Theme</div>
                        <div class="config-row-description">Interface color scheme</div>
                    </div>
                    <div class="config-row-right">
                        <div class="custom-dropdown" id="themeDropdown">
                            <div class="dropdown-header" onclick="toggleThemeDropdown()">
                                <span id="selectedTheme">System</span>
                            </div>
                            <div class="dropdown-content" id="themeDropdownContent">
                                <div id="themeOptions"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Application Section -->
            <div class="config-section">
                <h3 class="config-section-title">Application</h3>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Update Application</div>
                        <div class="config-row-description">Check for latest GitHub release</div>
                    </div>
                    <div class="config-row-right">
                        <button class="btn" onclick="checkForUpdates()">Check for Updates...</button>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Launch on Login</div>
                        <div class="config-row-description">Start Whisper4Windows with Windows</div>
                    </div>
                    <div class="config-row-right">
                        <div class="toggle-switch" id="launchOnLoginToggle" onclick="toggleLaunchOnLogin()"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SOUND PAGE -->
        <div id="page-sound" class="page hidden">
            <h1 class="section-title">Sound</h1>

            <!-- Microphone Section -->
            <div class="config-section">
                <h3 class="config-section-title">Microphone</h3>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Device</div>
                        <div class="config-row-description">Select microphone input</div>
                    </div>
                    <div class="config-row-right">
                        <div class="custom-dropdown" id="microphoneDropdown">
                            <div class="dropdown-header" onclick="toggleMicrophoneDropdown()">
                                <span id="selectedMicrophone">Default Microphone</span>
                            </div>
                            <div class="dropdown-content" id="microphoneDropdownContent">
                                <div id="microphoneOptions"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Automatically increase microphone volume</div>
                        <div class="config-row-description">Boost quiet audio automatically</div>
                    </div>
                    <div class="config-row-right">
                        <div class="toggle-switch active" id="autoVolumeToggle" onclick="toggleAutoVolume()"></div>
                    </div>
                </div>
            </div>

            <!-- Sound Effects Section -->
            <div class="config-section">
                <h3 class="config-section-title">Sound Effects</h3>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Enable sound effects</div>
                        <div class="config-row-description">Play sounds for recording events</div>
                    </div>
                    <div class="config-row-right">
                        <div class="toggle-switch active" id="soundEffectsToggle" onclick="toggleSoundEffects()"></div>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-row-left">
                        <div class="config-row-title">Volume</div>
                        <div class="config-row-description">Sound effects volume level</div>
                    </div>
                    <div class="config-row-right">
                        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="80" oninput="updateVolume()">
                    </div>
                </div>
            </div>
        </div>

        <!-- HISTORY PAGE -->
        <div id="page-history" class="page hidden">
            <h1 class="section-title">History</h1>
            <div class="coming-soon">
                <h3>üöß Coming Soon</h3>
                <p>Recording history feature is under development. You'll soon be able to view and manage past transcriptions.</p>
            </div>
        </div>
    </div>

    <!-- Shortcut Capture Modal -->
    <div id="shortcutModal" class="modal-overlay hidden">
        <div class="modal">
            <h3>Press your desired shortcut</h3>
            <p id="modalInstructions">Press any key combination (up to 3 keys)</p>
            <div class="shortcut-badge recording" id="modalShortcut">Listening...</div>
            <div class="modal-buttons" style="margin-top: 20px;">
                <button class="btn" onclick="cancelShortcutCapture()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- GPU Setup Modal -->
    <div id="gpuSetupModal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 500px;">
            <h3>üöÄ GPU Detected!</h3>
            <p>Your system has an NVIDIA GPU. Download GPU acceleration libraries (~600MB) for 5-10x faster transcription?</p>
            <p style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">
                <strong>With GPU:</strong> 5s audio ‚Üí 0.5-2s transcription<br>
                <strong>Without GPU:</strong> 5s audio ‚Üí 5-15s transcription
            </p>
            <p style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">
                You can always install this later from Configuration ‚Üí Processing Device.
            </p>
            <div id="gpuDownloadProgress" class="hidden" style="margin: 20px 0;">
                <div style="background: var(--border-color); height: 8px; border-radius: 4px; overflow: hidden;">
                    <div id="gpuProgressBar" style="background: #667eea; height: 100%; width: 0%; transition: width 0.3s;"></div>
                </div>
                <p id="gpuProgressText" style="font-size: 13px; margin-top: 8px; color: var(--text-secondary);">Preparing...</p>
            </div>
            <div class="modal-buttons" id="gpuModalButtons">
                <button class="btn" onclick="skipGPUSetup()">Skip</button>
                <button class="btn" onclick="startGPUDownload()" style="background: #667eea; color: white; border-color: #667eea;">Download (~600MB)</button>
            </div>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'http://127.0.0.1:8000';
        let selectedDevice = 'auto';
        let clipboardPasteEnabled = true;
        let launchOnLogin = false;
        let autoVolumeEnabled = true;
        let soundEffectsEnabled = true;
        let volume = 80;
        let preferredLanguages = [];

        // Sound Effects using Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playBeep(frequency, duration, volume) {
            if (!soundEffectsEnabled) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';

            const adjustedVolume = (volume / 100) * 0.3; // Max 30% volume
            gainNode.gain.setValueAtTime(adjustedVolume, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playStartSound() {
            playBeep(800, 0.1, volume); // Higher pitch, short beep
        }

        function playStopSound() {
            playBeep(400, 0.15, volume); // Lower pitch, slightly longer beep
        }

        // Shortcut state
        let shortcuts = {
            toggle: 'F9',
            cancel: 'Escape'
        };
        let capturingShortcut = null;
        let capturedKeys = [];

        // Page Navigation
        function navigateToPage(pageName, section) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });

            document.getElementById(`page-${pageName}`).classList.remove('hidden');

            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.sidebar-item[onclick*="${pageName}"]`).classList.add('active');

            if (section) {
                setTimeout(() => {
                    const sectionEl = document.getElementById(`section-${section}`);
                    if (sectionEl) {
                        sectionEl.scrollIntoView({ behavior: 'smooth' });
                    }
                }, 100);
            }
        }

        // Theme Management
        function changeTheme() {
            const theme = selectedThemeValue;
            let appliedTheme = theme;

            if (theme === 'system') {
                const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                appliedTheme = isDark ? 'dark' : 'light';
            }

            document.documentElement.setAttribute('data-theme', appliedTheme);
            localStorage.setItem('theme', theme);
        }

        // Shortcut Capture
        function captureShortcut(type) {
            capturingShortcut = type;
            capturedKeys = [];
            document.getElementById('shortcutModal').classList.remove('hidden');
            document.getElementById('modalShortcut').textContent = 'Listening...';
        }

        function cancelShortcutCapture() {
            capturingShortcut = null;
            capturedKeys = [];
            document.getElementById('shortcutModal').classList.add('hidden');
        }

        function resetShortcut(type) {
            const defaults = { toggle: 'F9', cancel: 'Escape' };
            shortcuts[type] = defaults[type];
            document.getElementById(`shortcut-${type}`).textContent = defaults[type];
            saveShortcuts();
        }

        async function saveShortcuts() {
            try {
                const { invoke } = window.__TAURI_INTERNALS__;
                await invoke('save_shortcuts', { shortcuts: shortcuts });
                console.log('‚úÖ Shortcuts saved:', shortcuts);
            } catch (error) {
                console.error('‚ùå Error saving shortcuts:', error);
            }
        }

        // Key capture logic
        document.addEventListener('keydown', (e) => {
            if (!capturingShortcut) return;

            e.preventDefault();

            const key = e.key;
            const modifiers = [];

            if (e.ctrlKey) modifiers.push('Ctrl');
            if (e.altKey) modifiers.push('Alt');
            if (e.shiftKey) modifiers.push('Shift');

            // Don't add modifier keys themselves
            if (['Control', 'Alt', 'Shift'].includes(key)) return;

            // Build shortcut string
            const shortcutParts = [...modifiers, key];
            const shortcut = shortcutParts.join('+');

            // Update display
            document.getElementById('modalShortcut').textContent = shortcut;

            // Save after short delay
            setTimeout(() => {
                shortcuts[capturingShortcut] = shortcut;
                document.getElementById(`shortcut-${capturingShortcut}`).textContent = shortcut;
                saveShortcuts();
                cancelShortcutCapture();
            }, 500);
        });

        // Backend Health Check
        async function checkBackendHealth() {
            try {
                const response = await fetch(`${BACKEND_URL}/health`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: { 'Accept': 'application/json' }
                });
                const data = await response.json();

                const statusEl = document.getElementById('backendStatus');
                statusEl.innerHTML = `<span>‚úÖ</span><span>${data.backend.toUpperCase()} Ready (${data.model})</span>`;
                statusEl.classList.remove('offline');
            } catch (error) {
                const statusEl = document.getElementById('backendStatus');
                statusEl.innerHTML = `<span>‚ùå</span><span>Backend Offline</span>`;
                statusEl.classList.add('offline');
            }
        }

        // Device Selection
        function selectDevice(device) {
            selectedDevice = device;

            const buttons = {
                'auto': document.getElementById('deviceAuto'),
                'cuda': document.getElementById('deviceGPU'),
                'cpu': document.getElementById('deviceCPU')
            };

            Object.values(buttons).forEach(btn => btn.classList.remove('active'));
            buttons[device].classList.add('active');

            saveSettings();
        }

        // Toggle Functions
        async function toggleClipboardPaste() {
            const toggle = document.getElementById('clipboardToggle');
            clipboardPasteEnabled = !clipboardPasteEnabled;

            if (clipboardPasteEnabled) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }

            try {
                const { invoke } = window.__TAURI_INTERNALS__;
                await invoke('set_clipboard_paste', { enabled: clipboardPasteEnabled });
            } catch (error) {
                console.error('‚ùå Error setting clipboard paste:', error);
            }
        }

        async function toggleLaunchOnLogin() {
            const toggle = document.getElementById('launchOnLoginToggle');
            launchOnLogin = !launchOnLogin;

            if (launchOnLogin) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }

            try {
                const { invoke } = window.__TAURI_INTERNALS__;
                await invoke('set_launch_on_login', { enabled: launchOnLogin });
            } catch (error) {
                console.error('‚ùå Error setting launch on login:', error);
            }
        }

        function toggleAutoVolume() {
            const toggle = document.getElementById('autoVolumeToggle');
            autoVolumeEnabled = !autoVolumeEnabled;

            if (autoVolumeEnabled) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }

            localStorage.setItem('autoVolume', autoVolumeEnabled);
        }

        function toggleSoundEffects() {
            const toggle = document.getElementById('soundEffectsToggle');
            soundEffectsEnabled = !soundEffectsEnabled;

            if (soundEffectsEnabled) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }

            localStorage.setItem('soundEffects', soundEffectsEnabled);
        }

        function updateVolume() {
            volume = document.getElementById('volumeSlider').value;
            localStorage.setItem('volume', volume);
        }

        // Language dropdown data (99 Whisper languages)
        const LANGUAGES = [
            { code: 'auto', name: 'Auto-Detect', pinned: true },
            { code: 'en', name: 'English' },
            { code: 'zh', name: 'Chinese' },
            { code: 'de', name: 'German' },
            { code: 'es', name: 'Spanish' },
            { code: 'ru', name: 'Russian' },
            { code: 'ko', name: 'Korean' },
            { code: 'fr', name: 'French' },
            { code: 'ja', name: 'Japanese' },
            { code: 'pt', name: 'Portuguese' },
            { code: 'tr', name: 'Turkish' },
            { code: 'pl', name: 'Polish' },
            { code: 'ca', name: 'Catalan' },
            { code: 'nl', name: 'Dutch' },
            { code: 'ar', name: 'Arabic' },
            { code: 'sv', name: 'Swedish' },
            { code: 'it', name: 'Italian' },
            { code: 'id', name: 'Indonesian' },
            { code: 'hi', name: 'Hindi' },
            { code: 'fi', name: 'Finnish' },
            { code: 'vi', name: 'Vietnamese' },
            { code: 'he', name: 'Hebrew' },
            { code: 'uk', name: 'Ukrainian' },
            { code: 'el', name: 'Greek' },
            { code: 'ms', name: 'Malay' },
            { code: 'cs', name: 'Czech' },
            { code: 'ro', name: 'Romanian' },
            { code: 'da', name: 'Danish' },
            { code: 'hu', name: 'Hungarian' },
            { code: 'ta', name: 'Tamil' },
            { code: 'no', name: 'Norwegian' },
            { code: 'th', name: 'Thai' },
            { code: 'ur', name: 'Urdu' },
            { code: 'hr', name: 'Croatian' },
            { code: 'bg', name: 'Bulgarian' },
            { code: 'lt', name: 'Lithuanian' },
            { code: 'la', name: 'Latin' },
            { code: 'mi', name: 'Maori' },
            { code: 'ml', name: 'Malayalam' },
            { code: 'cy', name: 'Welsh' },
            { code: 'sk', name: 'Slovak' },
            { code: 'te', name: 'Telugu' },
            { code: 'fa', name: 'Persian' },
            { code: 'lv', name: 'Latvian' },
            { code: 'bn', name: 'Bengali' },
            { code: 'sr', name: 'Serbian' },
            { code: 'az', name: 'Azerbaijani' },
            { code: 'sl', name: 'Slovenian' },
            { code: 'kn', name: 'Kannada' },
            { code: 'et', name: 'Estonian' },
            { code: 'mk', name: 'Macedonian' },
            { code: 'br', name: 'Breton' },
            { code: 'eu', name: 'Basque' },
            { code: 'is', name: 'Icelandic' },
            { code: 'hy', name: 'Armenian' },
            { code: 'ne', name: 'Nepali' },
            { code: 'mn', name: 'Mongolian' },
            { code: 'bs', name: 'Bosnian' },
            { code: 'kk', name: 'Kazakh' },
            { code: 'sq', name: 'Albanian' },
            { code: 'sw', name: 'Swahili' },
            { code: 'gl', name: 'Galician' },
            { code: 'mr', name: 'Marathi' },
            { code: 'pa', name: 'Punjabi' },
            { code: 'si', name: 'Sinhala' },
            { code: 'km', name: 'Khmer' },
            { code: 'sn', name: 'Shona' },
            { code: 'yo', name: 'Yoruba' },
            { code: 'so', name: 'Somali' },
            { code: 'af', name: 'Afrikaans' },
            { code: 'oc', name: 'Occitan' },
            { code: 'ka', name: 'Georgian' },
            { code: 'be', name: 'Belarusian' },
            { code: 'tg', name: 'Tajik' },
            { code: 'sd', name: 'Sindhi' },
            { code: 'gu', name: 'Gujarati' },
            { code: 'am', name: 'Amharic' },
            { code: 'yi', name: 'Yiddish' },
            { code: 'lo', name: 'Lao' },
            { code: 'uz', name: 'Uzbek' },
            { code: 'fo', name: 'Faroese' },
            { code: 'ht', name: 'Haitian Creole' },
            { code: 'ps', name: 'Pashto' },
            { code: 'tk', name: 'Turkmen' },
            { code: 'nn', name: 'Nynorsk' },
            { code: 'mt', name: 'Maltese' },
            { code: 'sa', name: 'Sanskrit' },
            { code: 'lb', name: 'Luxembourgish' },
            { code: 'my', name: 'Myanmar' },
            { code: 'bo', name: 'Tibetan' },
            { code: 'tl', name: 'Tagalog' },
            { code: 'mg', name: 'Malagasy' },
            { code: 'as', name: 'Assamese' },
            { code: 'tt', name: 'Tatar' },
            { code: 'haw', name: 'Hawaiian' },
            { code: 'ln', name: 'Lingala' },
            { code: 'ha', name: 'Hausa' },
            { code: 'ba', name: 'Bashkir' },
            { code: 'jw', name: 'Javanese' },
            { code: 'su', name: 'Sundanese' }
        ];

        let selectedLanguageCode = 'en';

        function initializeLanguageDropdown() {
            const optionsContainer = document.getElementById('languageOptions');
            optionsContainer.innerHTML = '';

            LANGUAGES.forEach(lang => {
                const option = document.createElement('div');
                option.className = 'dropdown-option' + (lang.pinned ? ' pinned' : '');
                option.textContent = lang.name;
                option.dataset.code = lang.code;
                option.dataset.name = lang.name;

                if (lang.code === selectedLanguageCode) {
                    option.classList.add('selected');
                }

                option.onclick = () => selectLanguage(lang.code, lang.name);
                optionsContainer.appendChild(option);
            });
        }

        function toggleLanguageDropdown() {
            const header = document.querySelector('#languageDropdown .dropdown-header');
            const content = document.getElementById('languageDropdownContent');
            const searchInput = document.getElementById('languageSearch');

            header.classList.toggle('open');
            content.classList.toggle('show');

            if (content.classList.contains('show')) {
                searchInput.value = '';
                filterLanguages();
                setTimeout(() => searchInput.focus(), 100);
            }
        }

        function selectLanguage(code, name) {
            selectedLanguageCode = code;
            document.getElementById('selectedLanguage').textContent = name;

            // Update selected state
            document.querySelectorAll('#languageOptions .dropdown-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.code === code) {
                    opt.classList.add('selected');
                }
            });

            // Close dropdown
            const header = document.querySelector('#languageDropdown .dropdown-header');
            const content = document.getElementById('languageDropdownContent');
            header.classList.remove('open');
            content.classList.remove('show');

            saveLanguage();
        }

        function filterLanguages() {
            const search = document.getElementById('languageSearch').value.toLowerCase();
            const options = document.querySelectorAll('#languageOptions .dropdown-option');

            options.forEach(option => {
                const name = option.dataset.name.toLowerCase();
                if (name.includes(search)) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        async function saveLanguage() {
            try {
                const { invoke } = window.__TAURI_INTERNALS__;
                await invoke('set_language', { language: selectedLanguageCode });
                console.log('‚úÖ Language saved:', selectedLanguageCode);
            } catch (error) {
                console.error('‚ùå Error saving language:', error);
            }
        }

        // Model dropdown data
        const MODELS = [
            { value: 'tiny', name: 'Tiny (Fastest)' },
            { value: 'base', name: 'Base' },
            { value: 'small', name: 'Small (Recommended)' },
            { value: 'medium', name: 'Medium' },
            { value: 'large-v3', name: 'Large V3 (Best)' }
        ];

        let selectedModelValue = 'small';

        function initializeModelDropdown() {
            const optionsContainer = document.getElementById('modelOptions');
            optionsContainer.innerHTML = '';

            MODELS.forEach(model => {
                const option = document.createElement('div');
                option.className = 'dropdown-option';
                option.textContent = model.name;
                option.dataset.value = model.value;

                if (model.value === selectedModelValue) {
                    option.classList.add('selected');
                }

                option.onclick = () => selectModel(model.value, model.name);
                optionsContainer.appendChild(option);
            });
        }

        function toggleModelDropdown() {
            const header = document.querySelector('#modelDropdown .dropdown-header');
            const content = document.getElementById('modelDropdownContent');

            header.classList.toggle('open');
            content.classList.toggle('show');
        }

        function selectModel(value, name) {
            selectedModelValue = value;
            document.getElementById('selectedModel').textContent = name;

            document.querySelectorAll('#modelOptions .dropdown-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.value === value) {
                    opt.classList.add('selected');
                }
            });

            const header = document.querySelector('#modelDropdown .dropdown-header');
            const content = document.getElementById('modelDropdownContent');
            header.classList.remove('open');
            content.classList.remove('show');

            saveSettings();
        }

        // Theme dropdown data
        const THEMES = [
            { value: 'system', name: 'System' },
            { value: 'light', name: 'Light' },
            { value: 'dark', name: 'Dark' }
        ];

        let selectedThemeValue = 'system';

        function initializeThemeDropdown() {
            const optionsContainer = document.getElementById('themeOptions');
            optionsContainer.innerHTML = '';

            THEMES.forEach(theme => {
                const option = document.createElement('div');
                option.className = 'dropdown-option';
                option.textContent = theme.name;
                option.dataset.value = theme.value;

                if (theme.value === selectedThemeValue) {
                    option.classList.add('selected');
                }

                option.onclick = () => selectTheme(theme.value, theme.name);
                optionsContainer.appendChild(option);
            });
        }

        function toggleThemeDropdown() {
            const header = document.querySelector('#themeDropdown .dropdown-header');
            const content = document.getElementById('themeDropdownContent');

            header.classList.toggle('open');
            content.classList.toggle('show');
        }

        function selectTheme(value, name) {
            selectedThemeValue = value;
            document.getElementById('selectedTheme').textContent = name;

            document.querySelectorAll('#themeOptions .dropdown-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.value === value) {
                    opt.classList.add('selected');
                }
            });

            const header = document.querySelector('#themeDropdown .dropdown-header');
            const content = document.getElementById('themeDropdownContent');
            header.classList.remove('open');
            content.classList.remove('show');

            changeTheme();
        }

        // Microphone dropdown
        let selectedMicrophoneValue = 'default';

        function initializeMicrophoneDropdown() {
            const optionsContainer = document.getElementById('microphoneOptions');
            optionsContainer.innerHTML = '';

            // Default microphone option
            const option = document.createElement('div');
            option.className = 'dropdown-option selected';
            option.textContent = 'Default Microphone';
            option.dataset.value = 'default';
            option.onclick = () => selectMicrophone('default', 'Default Microphone');
            optionsContainer.appendChild(option);
        }

        function toggleMicrophoneDropdown() {
            const header = document.querySelector('#microphoneDropdown .dropdown-header');
            const content = document.getElementById('microphoneDropdownContent');

            header.classList.toggle('open');
            content.classList.toggle('show');
        }

        function selectMicrophone(value, name) {
            selectedMicrophoneValue = value;
            document.getElementById('selectedMicrophone').textContent = name;

            document.querySelectorAll('#microphoneOptions .dropdown-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.value === value) {
                    opt.classList.add('selected');
                }
            });

            const header = document.querySelector('#microphoneDropdown .dropdown-header');
            const content = document.getElementById('microphoneDropdownContent');
            header.classList.remove('open');
            content.classList.remove('show');
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            const dropdowns = ['languageDropdown', 'modelDropdown', 'themeDropdown', 'microphoneDropdown'];

            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown && !dropdown.contains(e.target)) {
                    const header = dropdown.querySelector('.dropdown-header');
                    const content = dropdown.querySelector('.dropdown-content');
                    if (header) header.classList.remove('open');
                    if (content) content.classList.remove('show');
                }
            });
        });

        async function checkForUpdates() {
            try {
                alert('Checking for updates from GitHub...');

                const { invoke } = window.__TAURI_INTERNALS__;
                const result = await invoke('check_for_updates');

                alert(result);
            } catch (error) {
                console.error('‚ùå Error checking for updates:', error);
                alert('Failed to check for updates. Please check your internet connection.');
            }
        }

        async function saveSettings() {
            const model = selectedModelValue;

            try {
                const { invoke } = window.__TAURI_INTERNALS__;
                await invoke('set_model_and_device', {
                    model: model,
                    device: selectedDevice
                });
                console.log(`Settings saved: model=${model}, device=${selectedDevice}`);
            } catch (error) {
                console.error('Error saving settings:', error);
            }
        }

        // GPU Setup Functions
        async function checkGPUSetup(autoShow = true) {
            try {
                const response = await fetch(`${BACKEND_URL}/gpu/info`);
                const data = await response.json();

                console.log('üîç GPU Info:', data);

                if (data.success && data.gpu_available && !data.libs_installed) {
                    if (autoShow) {
                        // Check if user has already dismissed this prompt
                        const dismissed = localStorage.getItem('gpuSetupDismissed');
                        if (!dismissed) {
                            setTimeout(() => {
                                showGPUSetupModal();
                            }, 1000);
                        } else {
                            console.log('‚è≠Ô∏è GPU setup was previously dismissed');
                        }
                    }
                    return { needsSetup: true, data };
                } else if (!data.gpu_available) {
                    console.log('‚ÑπÔ∏è No NVIDIA GPU detected');
                    return { needsSetup: false, data };
                } else if (data.libs_installed) {
                    console.log('‚úÖ GPU libraries already installed');
                    return { needsSetup: false, data };
                }
            } catch (error) {
                console.error('‚ùå Error checking GPU setup:', error);
                return { needsSetup: false, error };
            }
        }

        function showGPUSetupModal() {
            // Reset modal state
            const modal = document.getElementById('gpuSetupModal');
            const buttons = document.getElementById('gpuModalButtons');
            const progress = document.getElementById('gpuDownloadProgress');

            buttons.classList.remove('hidden');
            progress.classList.add('hidden');

            modal.classList.remove('hidden');
        }

        function skipGPUSetup() {
            localStorage.setItem('gpuSetupDismissed', 'true');
            document.getElementById('gpuSetupModal').classList.add('hidden');
        }

        async function manualGPUSetup() {
            // Clear dismissed flag and recheck
            localStorage.removeItem('gpuSetupDismissed');
            const result = await checkGPUSetup(false); // Don't auto-show, we'll handle it

            if (result && result.needsSetup) {
                showGPUSetupModal();
            } else {
                try {
                    const response = await fetch(`${BACKEND_URL}/gpu/info`);
                    const data = await response.json();

                    if (!data.gpu_available) {
                        alert('No NVIDIA GPU detected on this system.');
                    } else if (data.libs_installed) {
                        alert('GPU libraries are already installed!');
                    } else {
                        alert('Failed to show GPU setup dialog. Check console for errors.');
                    }
                } catch (error) {
                    alert('Backend connection failed. Make sure the app is running.');
                }
            }
        }

        async function startGPUDownload() {
            const modal = document.getElementById('gpuSetupModal');
            const buttons = document.getElementById('gpuModalButtons');
            const progress = document.getElementById('gpuDownloadProgress');
            const progressBar = document.getElementById('gpuProgressBar');
            const progressText = document.getElementById('gpuProgressText');

            // Hide buttons, show progress
            buttons.classList.add('hidden');
            progress.classList.remove('hidden');

            try {
                progressText.textContent = 'Downloading GPU libraries...';
                progressBar.style.width = '10%';

                const response = await fetch(`${BACKEND_URL}/gpu/install`, {
                    method: 'POST'
                });

                // Simulate progress (since actual download takes time)
                let simulatedProgress = 10;
                const progressInterval = setInterval(() => {
                    if (simulatedProgress < 90) {
                        simulatedProgress += 5;
                        progressBar.style.width = simulatedProgress + '%';
                    }
                }, 2000);

                const data = await response.json();
                clearInterval(progressInterval);

                if (data.success) {
                    progressBar.style.width = '100%';
                    progressText.textContent = '‚úÖ GPU libraries installed successfully!';

                    // Store that setup is complete
                    localStorage.setItem('gpuSetupDismissed', 'true');

                    setTimeout(() => {
                        modal.classList.add('hidden');
                        alert('‚úÖ GPU libraries installed successfully!\n\n‚ö†Ô∏è IMPORTANT: You must close and restart the app for GPU acceleration to work.\n\nClose the app now and reopen it.');
                    }, 2000);
                } else {
                    progressBar.style.width = '0%';
                    progressText.textContent = '‚ùå Installation failed: ' + (data.error || 'Unknown error');

                    // Reset modal state after showing error for 2 seconds
                    setTimeout(() => {
                        progress.classList.add('hidden');
                        buttons.classList.remove('hidden');
                        progressText.textContent = 'Preparing...';
                    }, 2000);
                }
            } catch (error) {
                console.error('‚ùå GPU download error:', error);
                progressBar.style.width = '0%';
                progressText.textContent = '‚ùå Download failed. Check your internet connection.';

                // Reset modal state after showing error for 2 seconds
                setTimeout(() => {
                    progress.classList.add('hidden');
                    buttons.classList.remove('hidden');
                    progressText.textContent = 'Preparing...';
                }, 2000);
            }
        }

        // Wait for backend to be ready before checking GPU
        async function waitForBackendAndCheckGPU() {
            let retries = 0;
            const maxRetries = 10;

            while (retries < maxRetries) {
                try {
                    const response = await fetch(`${BACKEND_URL}/health`, {
                        method: 'GET',
                        mode: 'cors',
                        headers: { 'Accept': 'application/json' }
                    });

                    if (response.ok) {
                        console.log('‚úÖ Backend is ready');
                        // Backend is ready, now check GPU
                        await checkGPUSetup();
                        return;
                    }
                } catch (error) {
                    console.log(`‚è≥ Waiting for backend... (${retries + 1}/${maxRetries})`);
                }

                retries++;
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            console.log('‚ö†Ô∏è Backend not ready after 5 seconds, skipping GPU check');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Whisper4Windows UI Loaded');

            // Initialize all dropdowns
            initializeLanguageDropdown();
            initializeModelDropdown();
            initializeThemeDropdown();
            initializeMicrophoneDropdown();

            // Wait for backend and check if GPU setup is needed
            setTimeout(waitForBackendAndCheckGPU, 500);

            // Load theme
            const savedTheme = localStorage.getItem('theme') || 'system';
            selectedThemeValue = savedTheme;
            const themeObj = THEMES.find(t => t.value === savedTheme);
            if (themeObj) {
                document.getElementById('selectedTheme').textContent = themeObj.name;
            }
            initializeThemeDropdown(); // Refresh to show selected
            changeTheme();

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                if (selectedThemeValue === 'system') {
                    changeTheme();
                }
            });

            // Load clipboard paste setting
            try {
                const { invoke } = window.__TAURI_INTERNALS__;
                const enabled = await invoke('get_clipboard_paste');
                clipboardPasteEnabled = enabled;
                const toggle = document.getElementById('clipboardToggle');
                if (enabled) {
                    toggle.classList.add('active');
                } else {
                    toggle.classList.remove('active');
                }
            } catch (error) {
                console.error('‚ùå Error loading clipboard paste setting:', error);
            }

            // Load launch on login setting
            try {
                const { invoke } = window.__TAURI_INTERNALS__;
                const enabled = await invoke('get_launch_on_login');
                launchOnLogin = enabled;
                const toggle = document.getElementById('launchOnLoginToggle');
                if (enabled) {
                    toggle.classList.add('active');
                } else {
                    toggle.classList.remove('active');
                }
            } catch (error) {
                console.error('‚ùå Error loading launch on login setting:', error);
            }

            // Load sound settings from localStorage
            autoVolumeEnabled = localStorage.getItem('autoVolume') !== 'false';
            soundEffectsEnabled = localStorage.getItem('soundEffects') !== 'false';
            volume = parseInt(localStorage.getItem('volume') || '80');

            const autoVolumeToggle = document.getElementById('autoVolumeToggle');
            const soundEffectsToggle = document.getElementById('soundEffectsToggle');
            const volumeSlider = document.getElementById('volumeSlider');

            if (autoVolumeEnabled) autoVolumeToggle.classList.add('active');
            else autoVolumeToggle.classList.remove('active');

            if (soundEffectsEnabled) soundEffectsToggle.classList.add('active');
            else soundEffectsToggle.classList.remove('active');

            volumeSlider.value = volume;

            // Load saved language
            try {
                const { invoke } = window.__TAURI_INTERNALS__;
                const language = await invoke('get_language');
                if (language) {
                    selectedLanguageCode = language;
                    const lang = LANGUAGES.find(l => l.code === language);
                    if (lang) {
                        document.getElementById('selectedLanguage').textContent = lang.name;
                    }
                    initializeLanguageDropdown(); // Refresh to show selected
                }
            } catch (error) {
                console.error('‚ùå Error loading language:', error);
            }

            // Load saved shortcuts
            try {
                const { invoke } = window.__TAURI_INTERNALS__;
                const toggleShortcut = await invoke('get_toggle_shortcut');
                shortcuts.toggle = toggleShortcut;
                document.getElementById('shortcut-toggle').textContent = toggleShortcut;
            } catch (error) {
                console.error('‚ùå Error loading shortcuts:', error);
            }

            setTimeout(checkBackendHealth, 500);
            setTimeout(saveSettings, 1000);
        });

        // Export sound functions for overlay
        window.playStartSound = playStartSound;
        window.playStopSound = playStopSound;
    </script>
</body>
</html>
